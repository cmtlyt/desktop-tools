import{h as q}from"./index-ByKSOVCD.js";var E={};const k=Symbol&&Symbol("empty")||{},T=Reflect!=null&&Reflect.apply?e=>{let t=k;return(...s)=>(t===k&&(t=e()),typeof t!="function"?t:Reflect.apply(t,null,s))}:e=>{let t=k;return(...s)=>(t===k&&(t=e()),typeof t!="function"?t:t.apply(null,s))},K=T(()=>globalThis.navigator?globalThis.navigator.userAgent||globalThis.navigator.swuserAgent:process?`Node.js/${process.version} (${process.platform}; ${process.arch}) ${E.SHELL} ${E.LANG} ${E.TERM_PROGRAM}`:""),Q=T(()=>!K().toLocaleLowerCase().includes("node")&&window&&"onload"in window);function A(...e){var t;(t=globalThis==null?void 0:globalThis.__ClConfig__)!=null&&t.disableWarning||console.warn("@cmtlyt/base:>",...e)}function d(e){return Q()?typeof window<"u"&&window[e]!==void 0:(A("caniuse 只能在浏览器环境中使用"),!1)}function V(e){return e.byteLength>=65556&&A("buffer size too large, use arrayBufferToChunkBase64String"),btoa(String.fromCharCode.apply(null,new Uint8Array(e)))}function X(e){const t=e.split("|");return new Blob(t.map(s=>function(r){r.length>=65556&&A("base64 size too large, use chunkBase64StringToArrayBuffer");const n=atob(r),o=n.length,c=new Uint8Array(o);for(let u=0;u<o;u++)c[u]=n.charCodeAt(u);return c}(s)))}async function Y(e){return function(t){const r=[];let n=t.slice(r.length*10240,r.length*10240+10240);for(;n.byteLength>0;)r.push(V(n)),n=t.slice(r.length*10240,r.length*10240+10240);return r.join("|")}(await async function(t){const s=t.getReader(),r=[];let n=0;for(;;){const{done:u,value:a}=await s.read();if(u)break;r.push(a),n+=a.byteLength}const o=new ArrayBuffer(n);let c=0;for(const u of r){const a=new Uint8Array(u);new Uint8Array(o,c,a.length).set(a),c+=a.length}return o}(e))}var M,$=1e3,h=6e4,m=60*h,w=24*m,Z=7*w;function L(e,t,s,r){var n=t>=1.5*s;return Math.round(e/s)+" "+r+(n?"s":"")}function C(e=8){const t=Math.random().toString(36).slice(2,e+2);return t.length===e?t:t+C(e-t.length)}function x(e){const t=new Blob([e]);return URL.createObjectURL(t)}function N(e){return new Worker(e)}function O(){const e=[],t=r=>{e.push(r)},s=r=>{e.splice(e.indexOf(r),1)};return{on:t,remove:s,clearOn:()=>{e.length=0},onOnce:r=>{const n=(...o)=>{r.apply(null,o),s(n)};t(n)},emit:r=>{for(const n of e)n(r)}}}function B({emit:e,type:t,result:s,error:r,resolve:n=()=>{},reject:o=()=>{},isSysCall:c,eventData:u}){if(c)t==="success"?n(s):o(r);else{const{__clUserCall:a,data:i}=u;e(a?i:u)}}function D(e,t=[],s){if(!d("Worker"))return A("不支持 web worker 已降级"),{run:async(...a)=>await e(...a),dispose:()=>{},...O()};const{reuse:r=!0,needPost:n=!1}=s,o=function(a,i=[],f=!1){return`
${i.length?`importScripts("${i.join('", "')}");`:""}
const func = ${a};

const { postMessage } = (()=>{
  const postMessage = (data) => {
    self.postMessage({ __clUserCall: true, data })
  };
  return { postMessage: (data) => postMessage(data) };
})();

self.onmessage = async (e) => {
  const { callId, data: args } = e.data
  try {
    const result = await func.apply(null, ${f?"[postMessage, ...args]":"args"});
    self.postMessage({ __clSysCall: true, type: 'success', result, callId });
  } catch (e) {
    self.postMessage({ __clSysCall: true, callId, type: 'error', error: e })
  }
}
self.onerror = (e) => {
  self.postMessage({ __clSysCall: true, type: 'error', error: e })
}`}(e,function(a){const i=[],f=[];return a.forEach(l=>{typeof l=="string"?f.push(l):typeof l=="function"&&i.push(l)}),f.push(x(i.map(l=>`function ${l.name}(...args) { return (${l})(...args); }`).join(`
`))),f}(t),n),c=x(o);return r?function(i){const f=N(i);let l=!1,g={};const{emit:S,...j}=O();return f.onmessage=y=>{const{type:p,result:b,error:v,callId:R,__clSysCall:_}=y.data,{resolve:G,reject:H}=g[R]||{};_&&delete g[R],B({emit:S,type:p,result:b,error:v,resolve:G,reject:H,isSysCall:_,eventData:y.data})},{run:async(...y)=>{if(l)throw new Error("worker资源已释放");const p=C(16);return new Promise((b,v)=>{g[p]={resolve:b,reject:v},f.postMessage({callId:p,data:y})})},dispose:()=>{f.terminate(),g=null,l=!0,URL.revokeObjectURL(i)},...j}}(c):function(a){let i=!1;const{emit:f,...l}=O();return{run:async(...g)=>{if(i)throw new Error("worker资源已释放");const S=N(a);return new Promise((j,y)=>{S.onmessage=p=>{const{type:b,result:v,error:R,__clSysCall:_}=p.data;_&&S.terminate(),B({emit:f,type:b,result:v,error:R,resolve:j,reject:y,isSysCall:_,eventData:p.data})},S.postMessage({data:g})})},dispose:()=>{i=!0,URL.revokeObjectURL(a)},...l}}(c)}function U(e,t){let s,r=0;const n=36**t;for(;e.includes(s=C(t))&&++r<n;);return s}function I(e){return"#"}function P(e,t,s="#",r={}){const n=new RegExp(`(^{.*?(.{${t}})})|({.*?(.{${t}})}$)`),o=s.length+2;for(let c=0;c++<e.length;){const u=e.slice(c,c+t+o);if(e.includes(u,c+t+o))for(let a=c+t+o+1;a++<e.length;){const i=e.slice(c,a);if(!e.includes(i,a)){const f=U(Object.keys(r),t),l=e.slice(c,a-1);if(n.test(l))break;r[f]=l,e=e.replace(new RegExp(l.replace(/([[{(?)\\])/g,"\\$1"),"g"),`{${s}${f}}`),c+=9;break}}}return e}function z(e,t=6){const s={},r=P(e,t,"#",s);return JSON.stringify({cache:s,source:r,keyLength:t})}M=function(e,t){t=t||{};var s=typeof e;if(s==="string"&&e.length>0)return function(r){if(!((r=String(r)).length>100)){var n=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(n){var o=parseFloat(n[1]);switch((n[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return o*Z;case"days":case"day":case"d":return o*w;case"hours":case"hour":case"hrs":case"hr":case"h":return o*m;case"minutes":case"minute":case"mins":case"min":case"m":return o*h;case"seconds":case"second":case"secs":case"sec":case"s":return o*$;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if(s==="number"&&isFinite(e))return t.long?function(r){var n=Math.abs(r);return n>=w?L(r,n,w,"day"):n>=m?L(r,n,m,"hour"):n>=h?L(r,n,h,"minute"):n>=$?L(r,n,$,"second"):r+" ms"}(e):function(r){var n=Math.abs(r);return n>=w?Math.round(r/w)+"d":n>=m?Math.round(r/m)+"h":n>=h?Math.round(r/h)+"m":n>=$?Math.round(r/$)+"s":r+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))},M&&M.__esModule&&Object.prototype.hasOwnProperty.call(M,"default")&&M.default;D(z,[P,I,U,C],{reuse:!1});function J(e,t="#"){const{keyLength:s,cache:r}=e;let n,{source:o}=e;for(;n=new RegExp(`{${t}(.{${s}})}`,"g").exec(o);){const[c,u]=Array.from(n);o=o.replace(new RegExp(c,"g"),r[u])}return o}function W(e){return J(JSON.parse(e),"#")}D(W,[J,I,U,C],{reuse:!1});const F=T(()=>d("TextEncoder")&&d("ReadableStream")&&d("ArrayBuffer")&&d("Uint8Array")&&d("btoa")&&d("atob")&&d("TextDecoder"));async function te(e,t=6){if(!d("CompressionStream")||!F())return z(e,t);const s=function(r){const n=new TextEncoder;return new ReadableStream({start(o){o.enqueue(n.encode(r)),o.close()}})}(e).pipeThrough(new CompressionStream("gzip"));return Y(s)}async function re(e){if(!d("DecompressionStream")||!F())return W(e);const t=await async function(s){return X(s).stream()}(e);return async function(s){const r=s.getReader(),n=[];let o="";for(;;){const{done:u,value:a}=await r.read();if(u)break;n.push(a)}const c=new TextDecoder("utf-8");for(const u of n)o+=c.decode(u);return o+=c.decode(),o}(t.pipeThrough(new DecompressionStream("gzip")))}const{useStore:ne,useStoreSlice:se,getStore:oe}=q(e=>({currentNotepad:void 0,setNotepad:t=>e({currentNotepad:t})}));export{te as T,re as U,oe as g,se as u};
