import{m as z,B as w,r as s,j as e,l as f,k as F,C as K,D as P,E as V,G as q}from"./index-BbUEgvlw.js";import{A as W}from"./index-KBU5tDsl.js";import{b as l,c as S,a as L,F as D,e as J,B as Q,d as j}from"./button-COPmBX2y.js";import{H as X,S as G,a as Z,b as ee,e as te,c as re}from"./index-DkoNLx0F.js";import{B as se}from"./index-DjU0lWDj.js";import{D as ne}from"./index-CRy9mSfg.js";import{M as oe}from"./index-B9AAfa1A.js";import{S as ae}from"./icon-CljhmPXV.js";import"./index-B4g9YTQJ.js";import"./index-DebawM1V.js";import"./index-CAvK7Isu.js";import"./useLocale-iiRYa-tt.js";import"./asyncToGenerator-mEtNOVeJ.js";import"./Subject-NMHmtlRQ.js";import"./index-hUxgVUqh.js";import"./index-C9HUOCdF.js";import"./reactNode-AQXLKJoa.js";import"./pickAttrs-B9gf1G1X.js";import"./context-Bs2597AU.js";import"./Skeleton-DwFy40vk.js";import"./iconBase-ZNFPX1Te.js";import"./index-BkG9WYQw.js";import"./is-phone-PdjV9W0C.js";import"./UnstableContext-Ci8hDR-R.js";import"./LoadingOutlined-CCUCjfrn.js";import"./ExclamationCircleFilled-DZEzym_K.js";import"./InfoCircleFilled-DdfHzw4M.js";import"./ActionButton-dWEG3BOX.js";import"./PurePanel-DJz5vl6K.js";import"./compact-item-BFfGnoJ3.js";import"./fade-DxwG8Zdu.js";const{useStore:ze,useStoreSlice:ie,getStore:A}=z(t=>({speed:500,currentGameId:w(),replayStep:null,setSpeed:r=>t({speed:r}),reset:()=>t({currentGameId:w()}),replay:r=>t({replayStep:r})}));function ce(){const[t,r]=s.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(se,{buttons:[{text:"游戏规则",onClick(){oe.info({title:"游戏规则",okText:"知道了",centered:!0,content:e.jsx(W,{onFirstAppear:()=>f.appear("game-sbwd-rule"),children:e.jsxs(l,{$gap:"0.3",$direction:S.COLUMN,children:[e.jsx("span",{children:"1. 点击指针, 其指针顺时针旋转 90 度后指向的圆圈指针依次旋转"}),e.jsx("span",{children:"2. 剩余步数用完, 游戏结束"})]})})})}},{text:"游戏记录",onClick:()=>r(!0)},{text:"重置",onClick:()=>A().reset()}]}),e.jsx(X,{open:t,storeKey:G,onClose:()=>r(!1),children:o=>e.jsxs(Z,{$direction:S.COLUMN,$gap:"0.5",children:[e.jsxs(ee,{$alignItems:L.CENTER,$justifyContent:D.BETWEEN,children:[e.jsxs("span",{children:["分数: ",o.totalRotate]}),e.jsx(ne,{format:"yyyy-MM-DD hh:mm:ss",children:o.time})]}),e.jsx(l,{$justifyContent:D.END,children:e.jsx(J,{$presetTheme:Q.PRIMARY,onClick:()=>{const p=o.stepHistory;r(!1),A().replay(p),f.click("game-sbwd-history-replay",{stepHistory:p})},children:"重放"})})]},o.gameId)})]})}const pe=j(l)`
  padding: var(--page-padding);
`,le=j(l)`
  width: 60vmin;
  height: 60vmin;
`,ue=s.memo(j(ae)`
  width: 100%;
  height: 100%;
  transform: rotate(${({$rotate:t})=>t}deg);
  transition: transform ${({$speed:t})=>t}ms;
`),O=j.span`
  font-size: 3rem;
`;function me(t){return t%360===0?"top":t%360===90?"right":t%360===180?"bottom":"left"}function fe(t,r,o){return o==="top"?[t-1,r]:o==="right"?[t,r+1]:o==="bottom"?[t+1,r]:[t,r-1]}function Ke(){const t=[5,5],[r,o]=t,{speed:p,currentGameId:d,replayStep:h}=ie(["speed","currentGameId","replayStep"]),[U,T]=s.useState(Array.from({length:r},()=>new Array(o).fill(0))),[x,b]=s.useState(0),[R,B]=s.useState(10),[u,H]=s.useState(!1),$=s.useRef([]),C=s.useRef(d),g=s.useRef(h),I=s.useRef(!1),k=s.useMemo(()=>{const n=V((a,c)=>{b(i=>i+90),T(q(i=>{var N;const y=i[a][c]=i[a][c]+90,Y=me(y),[M,v]=fe(a,c,Y),_=(N=i[M])==null?void 0:N[v];setTimeout(()=>{if(_===void 0)return H(!1);n(M,v)},p)}))},10,!0);return n},[p]),E=s.useCallback((n,a)=>{u||($.current.push(`${n},${a}`),H(!0),k(n,a),B(c=>c-1))},[u,k]),m=s.useCallback(()=>{$.current=[],T(Array.from({length:r},()=>new Array(o).fill(0))),B(10),b(0),I.current=!1},[r,o]);return s.useEffect(()=>{if(!u&&R<=0){if(I.current)return F().showMessage({content:"回放结束"});const n={gameId:C.current,totalRotate:x,stepHistory:$.current};K(G,{...n,time:Date.now()}),P(),f.event("game-sbwd-over",n),f.expose("game-sbwd-over"),te({id:"reload-history",type:re.RELOAD_HISTORY}),F().showMessage({content:`游戏结束, 当前分数 ${x}!`,onClose:m})}},[u,m,x,R]),s.useEffect(()=>{C.current!==d&&(C.current=d,m())},[d,m]),s.useEffect(()=>{var a;if(!h)return;(a=g.current)!=null&&a.length||(m(),I.current=!0,g.current=h.slice());const n=setInterval(()=>{var y;if(u)return;const[c,i]=((y=g.current.shift())==null?void 0:y.split(",").map(Number))||[];if(E(c,i),!g.current.length){clearInterval(n),A().replay(null);return}},p);return()=>clearInterval(n)},[h,p,u,E,m]),e.jsx(W,{onFirstAppear:()=>f.appear("game-sbwd"),children:e.jsxs(pe,{$flex:"1",$gap:"5",$direction:S.COLUMN,$alignItems:L.CENTER,$justifyContent:D.CENTER,children:[e.jsxs(l,{$gap:"1",children:[e.jsxs(O,{children:["剩余步数: ",R]}),e.jsxs(O,{children:["当前度数: ",x]})]}),e.jsx(le,{$direction:S.COLUMN,$gap:"1",children:U.map((n,a)=>e.jsx(l,{$gap:"1",children:n.map((c,i)=>e.jsx(l,{$flex:"1",onClick:()=>E(a,i),children:e.jsx(ue,{$rotate:c,$speed:p})},i))},a))})]})})}const Pe={title:"十步万度",needBackIcon:!0,rightArea:e.jsx(ce,{})};export{Ke as Component,Pe as handle};
