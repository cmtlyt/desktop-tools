import{n as z,C as w,r as s,j as e,l as f,G as K,m as O,D as P,E as V,H as J}from"./index-DwZ3VcdL.js";import{A as L}from"./index-D7gmBVc6.js";import{b as l,c as S,F as A,a as W,e as q,B as Q,d as j}from"./button-BxUGn_cn.js";import{H as X,S as G,a as Z,b as ee,e as te,c as re}from"./index-Bp4OTeTq.js";import{B as se}from"./index-Rcsh-DYt.js";import{D as ne}from"./index-BS5FmYRV.js";import{M as oe}from"./index-CBn2k1pT.js";import{S as ie}from"./icon-_eQfRQ1t.js";import"./index-B4g9YTQJ.js";import"./index-RXfxmJ7z.js";import"./index-Bcuwydoc.js";import"./useLocale-CE8QlpIE.js";import"./asyncToGenerator-B1e0bwTg.js";import"./Subject-Nip3sQUI.js";import"./array-Cp_sd-Sf.js";import"./index-kDSs74VK.js";import"./index-BlV_hajW.js";import"./index-te4-RsG4.js";import"./reactNode-B9hRVRxn.js";import"./pickAttrs-CZcRfMez.js";import"./context-BmtueWsQ.js";import"./Skeleton-Do_K7evh.js";import"./iconBase-BFWPPRPh.js";import"./index-cB1IlPo3.js";import"./is-phone-yIPvuEgq.js";import"./UnstableContext-Ctka8GEx.js";import"./LoadingOutlined-LsngurYf.js";import"./ExclamationCircleFilled-Dggzy_mi.js";import"./InfoCircleFilled-C4hV1Ub-.js";import"./ActionButton-B4-YPTq7.js";import"./PurePanel-DPtUqUj9.js";import"./compact-item-IKBUWjwX.js";import"./index-CZE0y2XG.js";import"./fade-DBHzhfQ-.js";const{useStoreSlice:ae,getStore:D}=z(t=>({speed:500,currentGameId:w(),replayStep:null,setSpeed:r=>t({speed:r}),reset:()=>t({currentGameId:w()}),replay:r=>t({replayStep:r})}));function pe(){const[t,r]=s.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(se,{buttons:[{text:"游戏规则",onClick(){oe.info({title:"游戏规则",okText:"知道了",centered:!0,content:e.jsx(L,{onFirstAppear:()=>f.appear("game-sbwd-rule"),children:e.jsxs(l,{$gap:"0.3",$direction:S.COLUMN,children:[e.jsx("span",{children:"1. 点击指针, 其指针顺时针旋转 90 度后指向的圆圈指针依次旋转"}),e.jsx("span",{children:"2. 剩余步数用完, 游戏结束"})]})})})}},{text:"游戏记录",onClick:()=>r(!0)},{text:"重置",onClick:()=>D().reset()}]}),e.jsx(X,{open:t,storeKey:G,onClose:()=>r(!1),children:o=>e.jsxs(Z,{$direction:S.COLUMN,$gap:"0.5",children:[e.jsxs(ee,{$alignItems:W.CENTER,$justifyContent:A.BETWEEN,children:[e.jsxs("span",{children:["分数: ",o.totalRotate]}),e.jsx(ne,{format:"yyyy-MM-DD hh:mm:ss",children:o.time})]}),e.jsx(l,{$justifyContent:A.END,children:e.jsx(q,{$presetTheme:Q.PRIMARY,onClick:()=>{const c=o.stepHistory;r(!1),D().replay(c),f.click("game-sbwd-history-replay",{stepHistory:c})},children:"重放"})})]},o.gameId)})]})}const ce=j(l)`
  padding: var(--page-padding);
`,le=j(l)`
  width: 60vmin;
  height: 60vmin;
`,me=s.memo(j(ie)`
  width: 100%;
  height: 100%;
  transform: rotate(${({$rotate:t})=>t}deg);
  transition: transform ${({$speed:t})=>t}ms;
`),F=j.span`
  font-size: 3rem;
`;function ue(t){return t%360===0?"top":t%360===90?"right":t%360===180?"bottom":"left"}function fe(t,r,o){return o==="top"?[t-1,r]:o==="right"?[t,r+1]:o==="bottom"?[t+1,r]:[t,r-1]}function Ve(){const t=[5,5],[r,o]=t,{speed:c,currentGameId:d,replayStep:h}=ae(["speed","currentGameId","replayStep"]),[U,H]=s.useState(Array.from({length:r},()=>new Array(o).fill(0))),[x,T]=s.useState(0),[R,b]=s.useState(10),[m,B]=s.useState(!1),$=s.useRef([]),C=s.useRef(d),g=s.useRef(h),I=s.useRef(!1),M=s.useMemo(()=>{const n=K((i,p)=>{T(a=>a+90),H(J(a=>{var N;const y=a[i][p]=a[i][p]+90,Y=ue(y),[k,v]=fe(i,p,Y),_=(N=a[k])==null?void 0:N[v];setTimeout(()=>{if(_===void 0)return B(!1);n(k,v)},c)}))},10,!0);return n},[c]),E=s.useCallback((n,i)=>{m||($.current.push(`${n},${i}`),B(!0),M(n,i),b(p=>p-1))},[m,M]),u=s.useCallback(()=>{$.current=[],H(Array.from({length:r},()=>new Array(o).fill(0))),b(10),T(0),I.current=!1},[r,o]);return s.useEffect(()=>{if(!m&&R<=0){if(I.current)return O().showMessage({content:"回放结束"});const n={gameId:C.current,totalRotate:x,stepHistory:$.current};P(G,{...n,time:Date.now()}),V(),f.event("game-sbwd-over",n),f.expose("game-sbwd-over"),te({id:"reload-history",type:re.RELOAD_HISTORY}),O().showMessage({content:`游戏结束, 当前分数 ${x}!`,onClose:u})}},[m,u,x,R]),s.useEffect(()=>{C.current!==d&&(C.current=d,u())},[d,u]),s.useEffect(()=>{var i;if(!h)return;(i=g.current)!=null&&i.length||(u(),I.current=!0,g.current=h.slice());const n=setInterval(()=>{var y;if(m)return;const[p,a]=((y=g.current.shift())==null?void 0:y.split(",").map(Number))||[];if(E(p,a),!g.current.length){clearInterval(n),D().replay(null);return}},c);return()=>clearInterval(n)},[h,c,m,E,u]),e.jsx(L,{onFirstAppear:()=>f.appear("game-sbwd"),children:e.jsxs(ce,{$flex:"1",$gap:"5",$direction:S.COLUMN,$alignItems:W.CENTER,$justifyContent:A.CENTER,children:[e.jsxs(l,{$gap:"1",children:[e.jsxs(F,{children:["剩余步数: ",R]}),e.jsxs(F,{children:["当前度数: ",x]})]}),e.jsx(le,{$direction:S.COLUMN,$gap:"1",children:U.map((n,i)=>e.jsx(l,{$gap:"1",children:n.map((p,a)=>e.jsx(l,{$flex:"1",onClick:()=>E(i,a),children:e.jsx(me,{$rotate:p,$speed:c})},a))},i))})]})})}const Je={title:"十步万度",needBackIcon:!0,rightArea:e.jsx(pe,{})};export{Ve as Component,Je as handle};
