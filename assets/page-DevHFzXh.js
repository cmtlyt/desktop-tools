import{p as C,r as n,o as s,u as F}from"./index-LKB_47o9.js";import{l as a,d as h,A as j,b as v,B as w}from"./index-BeK9J_P4.js";import{c as B,a as R,b as I,g as V}from"./flow-Biu3FXCq.js";import{P as u,F as k}from"./flow-form-Cyx6IYux.js";import{B as y}from"./index-C5k_3aVV.js";import{S as _,c as D}from"./create-action-subscribe-hook-B8PYsfjv.js";import"./store-D4Ngc2bC.js";import"./index-DLUWWLMN.js";import"./index-D3oiLbP0.js";import"./PurePanel-DEhpyn8p.js";import"./render-CBkPc5Ov.js";import"./index-DFWCW1bo.js";const p=B(t=>({id:"",setId:e=>t({id:e})})),S=t=>p(R(t));function L(){return p.getState()}var i=(t=>(t.SAVE="save",t.SAVE_SUCCESS="save_success",t))(i||{});const l=new _;function m(t){l.next(t),a.event("editor-action",t)}const f=D(l),P=h(v)`
  padding: var(--page-padding);
`;function K(){const{id:t}=C(),{setId:e}=S("setId"),o=n.useRef({}),[E,g]=n.useState(!1),d=t?u.EDITOR:u.CREATE;n.useEffect(()=>{e(t||"")},[e,t]),f(r=>{if(r.id!==t)return a.error("action.id !== id",r);o.current.form.validateFields().then(()=>{o.current.form.submit(),g(!0)})},i.SAVE);const x=n.useCallback(r=>{const{id:c}=L(),{addFlow:A,updateFlow:b}=I();c.length?b(c,r):A(r),m({id:c,type:i.SAVE_SUCCESS})},[]);return s.jsx(j,{onFirstAppear:()=>a.appear("flow-editor",{id:t,pageStatus:d}),children:s.jsx(P,{children:s.jsx(k,{ref:o,disabled:E,pageStatus:d,onFinish:x})})})}function T(){const{id:t}=S("id"),e=F();return f(o=>{if(o.id!==t)return a.error("action.id !== id",o);V().showMessage({type:"success",content:"保存成功",onClose(){e("/flow")}})},i.SAVE_SUCCESS),s.jsx(y,{buttons:[{text:"取消",onClick(){e(-1)}},{text:"保存",$presetTheme:w.PRIMARY,onClick(){m({id:t,type:i.SAVE})}}]})}const Q={title:"编辑",needBackIcon:!0,rightArea:s.jsx(T,{})};async function X({params:t}){return{id:t.id||""}}export{K as Component,Q as handle,X as loader};
