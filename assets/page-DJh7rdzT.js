import{n as xe,r as C,j as i,aJ as G,G as ne,m as re,H as ae,aK as ye,a5 as be,a4 as Q,l as ue}from"./index-DwZ3VcdL.js";import{R as fe}from"./index-CGks_N0C.js";import{d as B,b as V,e as Se}from"./button-BxUGn_cn.js";import{a as Ce,b as je}from"./index-J2AipWCc.js";import{a as Pe,b as Ee}from"./index-DRoDy7bY.js";import{I as Re}from"./index-Bagtf7U1.js";import{D as oe}from"./index-kDSs74VK.js";import{S as he}from"./index-Baf81WNP.js";import{S as ke}from"./index-B4g9YTQJ.js";import{S as Ie}from"./index-BkSxskOT.js";import{i as Ae}from"./is-phone-yIPvuEgq.js";import{u as Le}from"./use-web-worker-CrXNPIIT.js";import"./index-BS5FmYRV.js";import"./index-Rcsh-DYt.js";import"./iconBase-BFWPPRPh.js";import"./index-cB1IlPo3.js";import"./index-te4-RsG4.js";import"./asyncToGenerator-B1e0bwTg.js";import"./reactNode-B9hRVRxn.js";import"./pickAttrs-CZcRfMez.js";import"./compact-item-IKBUWjwX.js";import"./fade-DBHzhfQ-.js";import"./LoadingOutlined-LsngurYf.js";import"./useForceUpdate-DqwNPTIk.js";import"./PurePanel-DPtUqUj9.js";import"./UnstableContext-Ctka8GEx.js";import"./useLocale-CE8QlpIE.js";import"./EyeOutlined-CNjMdUWL.js";import"./index-BlV_hajW.js";import"./context-BmtueWsQ.js";import"./Skeleton-Do_K7evh.js";import"./useVariants-PCdYoXqz.js";import"./index-Bcuwydoc.js";const{useStoreSlice:ie,getStore:X}=xe((c,f)=>({images:[],showForm:!1,saveSize:{width:0,height:0,aspectRatio:1},setImages:e=>c({images:e}),setShowForm:e=>c({showForm:e}),setSaveSize:e=>c({saveSize:{...f().saveSize,...e}})})),Te=B.span`
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  text-align: center;
  vertical-align: middle;
`,ze=B.section`
  position: relative;
  z-index: ${c=>c.$zIndex||0};
  overflow: hidden;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  min-height: 2em;
  line-height: 2em;

  ${c=>c.$option?ye(["bg","text"],c.$option):{}}

  input {
    position: absolute;
    z-index: -1;
    top: 0;
    left: 0;
    width: 0;
    height: 0;
    opacity: 0;
    font-size: 0;
  }
`,Ue=B.section`
  position: relative;

  flex: 1;
  display: grid;
  grid-template-rows: ${c=>{const f=["auto"],e=c.$list,a=e.length;for(let h=1;h<a;++h){const{fontSize:w}=e[h];f.push(c.$extendList.has(h)?"auto":w?`${parseFloat(w)*2}px`:"2em")}return f.join(" ")}};

  max-width: 40rem;
`,Fe=B.img`
  position: relative;
  vertical-align: middle;
  width: 100%;
`,Be=B.section`
  display: flex;
  flex-direction: column;

  @media screen and (min-width: 768px) {
    flex-direction: row;
  }
`,De=new Set(["bg","color","fontSize"]);function de(c){const{data:f,idx:e,zIndex:a,onClick:h}=c;return i.jsxs(ze,{$zIndex:a,$option:f,onClick:()=>h(e),children:[i.jsx(Fe,{src:f.bg,alt:f.text,crossOrigin:"anonymous"}),i.jsx(Te,{children:f.text})]},e)}const Oe=C.memo(C.forwardRef((c,f)=>{const{list:e,...a}=c,h=C.useRef(new Set),[,w]=C.useState(0),l=C.useCallback(()=>{w(m=>(m+1)%10)},[]),s=C.useCallback(m=>{h.current[h.current.has(m)?"delete":"add"](m),l()},[l]);return i.jsxs("section",{style:{padding:"1rem"},children:[i.jsx(he,{when:!e.length,children:()=>i.jsx(V,{$justifyContent:"center",children:"请点击右上方配置按钮, 配置信息"})}),i.jsx(Ue,{ref:f,$list:e,$extendList:h.current,...a,children:e.map((m,n)=>i.jsx(de,{data:m,idx:n,onClick:s,zIndex:e.length-n},n))})]})})),$e=B(V)`
  input {
    flex: 1;
    border: 1px solid #ccc;
    border-radius: 1rem;
  }
`,Me=B(V)`
  .ant-select {
    flex: 1;
  }
  & > svg {
    font-size: 2rem;
  }
`,se=C.memo(c=>{const{idx:f,data:e={},disableRemove:a=!1,images:h,onChange:w,onEditOption:l=G,onRemove:s=G}=c;return i.jsxs(V,{$direction:"column",$gap:"0.5rem",children:[i.jsxs(Me,{$alignItems:"center",$gap:"0.5rem",children:[i.jsx(Ie,{value:e.bg||"",options:h,onChange:m=>w(f,"bg",m)}),i.jsx(he,{when:!a,children:()=>i.jsx(Ee,{onClick:()=>s(f)})})]}),i.jsxs($e,{$gap:"0.5rem",children:[i.jsx("input",{type:"text",defaultValue:e.text||"",onChange:m=>w(f,"text",m.target.value)}),i.jsx(Se,{onClick:()=>l({...e,idx:f}),children:"配置"})]})]})});function He(c,f,e){!e[f]||c[0][f]||c.forEach(a=>{a[f]||(a[f]=e[f])})}const ce=B.label`
  display: flex;
  align-items: center;
  line-height: 1;

  span {
    flex: 1;
    font-size: 1.6rem;

    &::after {
      content: ':';
      padding-right: 1rem;
    }
  }

  input {
    box-sizing: border-box;
    flex: 2;
    height: 2em;
  }
`;function Ne(c){const{data:f,onChange:e}=c,[a,h]=C.useState(f),w=C.useCallback(ne(e,500),[e]),l=C.useCallback((s,m)=>{h(s),w(s.idx,m,s[m])},[w]);return i.jsxs(i.Fragment,{children:[i.jsx(de,{data:a,idx:a.idx,zIndex:0,onClick:G}),i.jsxs(V,{$direction:"column",$gap:"1rem",style:{paddingTop:"1rem"},children:[i.jsxs(ce,{children:[i.jsx("span",{children:"文字颜色"}),i.jsx("input",{type:"color",value:a.color||"",onChange:s=>l({...a,color:s.target.value},"color")})]}),i.jsxs(ce,{children:[i.jsx("span",{children:"文字大小"}),i.jsx("input",{type:"number",value:a.fontSize?parseFloat(a.fontSize):"",onChange:s=>l({...a,fontSize:`${s.target.value}px`},"fontSize")})]})]})]})}const Ve=C.memo(c=>{const{list:f,onChange:e}=c,{images:a}=ie("images"),h=C.useRef({inheritIdx:0}),[w,l]=C.useState(null),s=C.useCallback(ne((n,t,P)=>{e(ae(g=>{const R=n>=g.length;if(R&&!P)return;const z=g[n]||{...h.current,idx:n};R&&g.push(z),z[t]=P||"",De.has(t)&&(!h.current[t]||h.current.inheritIdx<=n&&h.current[t]!==P)&&(h.current.inheritIdx=n,h.current[t]=P,He(g,t,h.current))}))},500),[e]),m=C.useCallback(n=>{e(ae(t=>{t.splice(n,1)}))},[e]);return i.jsxs(i.Fragment,{children:[i.jsxs(V,{$direction:"column",$gap:"0.8rem",children:[f.map((n,t)=>i.jsx(se,{idx:t,images:a,data:n,onChange:s,onEditOption:l,onRemove:m},t)),i.jsx(se,{idx:f.length,images:a,disableRemove:!0,onChange:s},f.length)]}),i.jsx(oe,{open:!!w,title:"文本配置",onClose:()=>l(null),children:w&&i.jsx(Ne,{data:w,onChange:s})})]})}),le=B(oe)`
  background: transparent !important;

  .ant-drawer-header,
  .ant-drawer-body {
    background: #fff;
  }

  .ant-drawer-body {
    opacity: ${Ae()?"0.7":"1"};
  }
`,We=B(V)`
  padding-bottom: 1.5rem;

  input {
    height: 2em;
    border: 1px solid #ccc;
    border-radius: 1rem;
  }
`,_e=B(V)`
  & > svg {
    font-size: 2rem;
  }
`,Ge=C.memo(({applyDomSize:c})=>{const{saveSize:f}=ie("saveSize"),[e,a]=C.useState(!0),h=C.useCallback((l,s)=>{const{saveSize:m,setSaveSize:n}=X(),{...t}=m;if(e){const P=m.aspectRatio;l==="width"?(t.width=Number(s),t.height=Number(s)/P):(t.height=Number(s),t.width=Number(s)*P)}else t[l]=Number(s),t.aspectRatio=t.width/t.height;n(t)},[e]),w=C.useCallback(()=>{a(l=>!l)},[]);return i.jsxs(We,{$gap:"0.5rem",$alignItems:"center",children:[i.jsx("input",{type:"number",value:f.width,onChange:l=>h("width",l.target.value)}),i.jsx("input",{type:"number",value:f.height,onChange:l=>h("height",l.target.value)}),i.jsxs(_e,{$alignItems:"center",$gap:"0.5rem",onClick:w,children:[i.jsx(ke,{when:e,fullback:i.jsx(je,{}),children:()=>i.jsx(Ce,{})}),i.jsx(Pe,{onClick:()=>{c(),re().showMessage({type:"success",content:"同步成功",duration:1})}})]})]})}),Xe=C.memo(c=>{const{list:f,applyDomSize:e=G,onChange:a=G}=c,{showForm:h}=ie(["showForm"]),[w,l]=C.useState(!1),s=C.useCallback(ne((m,n)=>{X().setImages(n.map(t=>({value:t.url,label:t.name}))),re().showMessage({type:"success",content:"图片上传成功"})},300),[]);return i.jsxs(le,{open:h,className:le,title:"配置信息",width:"40rem",onClose:()=>X().setShowForm(!1),extra:i.jsx(fe,{buttons:[{text:"图片管理",onClick:()=>l(!0)}]}),children:[i.jsx(Ge,{applyDomSize:e}),i.jsx(Ve,{list:f,onChange:a}),i.jsx(oe,{open:w,title:"图片管理",width:"40rem",onClose:()=>l(!1),children:i.jsx(Re,{placeholderText:"上传图片资源",onChange:s})})]})});var me={exports:{}};(function(c){(function(f){var e=W(),a=ge(),h=ve(),w=we(),l={imagePlaceholder:void 0,cacheBust:!1},s={toSvg:m,toPng:t,toJpeg:P,toBlob:g,toPixelData:n,impl:{fontFaces:h,images:w,util:e,inliner:a,options:{}}};c.exports=s;function m(u,o){return o=o||{},R(o),Promise.resolve(u).then(function(v){return q(v,o.filter,!0)}).then(J).then(Z).then(d).then(function(v){return Y(v,o.width||e.width(u),o.height||e.height(u))});function d(v){return o.bgcolor&&(v.style.backgroundColor=o.bgcolor),o.width&&(v.style.width=o.width+"px"),o.height&&(v.style.height=o.height+"px"),o.style&&Object.keys(o.style).forEach(function(S){v.style[S]=o.style[S]}),v}}function n(u,o){return z(u,o||{}).then(function(d){return d.getContext("2d").getImageData(0,0,e.width(u),e.height(u)).data})}function t(u,o){return z(u,o||{}).then(function(d){return d.toDataURL()})}function P(u,o){return o=o||{},z(u,o).then(function(d){return d.toDataURL("image/jpeg",o.quality||1)})}function g(u,o){return z(u,o||{}).then(e.canvasToBlob)}function R(u){typeof u.imagePlaceholder>"u"?s.impl.options.imagePlaceholder=l.imagePlaceholder:s.impl.options.imagePlaceholder=u.imagePlaceholder,typeof u.cacheBust>"u"?s.impl.options.cacheBust=l.cacheBust:s.impl.options.cacheBust=u.cacheBust}function z(u,o){return m(u,o).then(e.makeImage).then(e.delay(100)).then(function(v){var S=d(u);return S.getContext("2d").drawImage(v,0,0),S});function d(v){var S=document.createElement("canvas");if(S.width=o.width||e.width(v),S.height=o.height||e.height(v),o.bgcolor){var b=S.getContext("2d");b.fillStyle=o.bgcolor,b.fillRect(0,0,S.width,S.height)}return S}}function q(u,o,d){if(!d&&o&&!o(u))return Promise.resolve();return Promise.resolve(u).then(v).then(function(p){return S(u,p,o)}).then(function(p){return b(u,p)});function v(p){return p instanceof HTMLCanvasElement?e.makeImage(p.toDataURL()):p.cloneNode(!1)}function S(p,x,L){var D=p.childNodes;if(D.length===0)return Promise.resolve(x);return k(x,e.asArray(D),L).then(function(){return x});function k(_,T,I){var U=Promise.resolve();return T.forEach(function(N){U=U.then(function(){return q(N,I)}).then(function(F){F&&_.appendChild(F)})}),U}}function b(p,x){if(!(x instanceof Element))return x;return Promise.resolve().then(L).then(D).then(k).then(_).then(function(){return x});function L(){T(window.getComputedStyle(p),x.style);function T(I,U){I.cssText?U.cssText=I.cssText:N(I,U);function N(F,$){e.asArray(F).forEach(function(r){$.setProperty(r,F.getPropertyValue(r),F.getPropertyPriority(r))})}}}function D(){[":before",":after"].forEach(function(I){T(I)});function T(I){var U=window.getComputedStyle(p,I),N=U.getPropertyValue("content");if(N===""||N==="none")return;var F=e.uid();x.className=x.className+" "+F;var $=document.createElement("style");$.appendChild(r(F,I,U)),x.appendChild($);function r(y,E,j){var A="."+y+":"+E,O=j.cssText?ee(j):te(j);return document.createTextNode(A+"{"+O+"}");function ee(M){var H=M.getPropertyValue("content");return M.cssText+" content: "+H+";"}function te(M){return e.asArray(M).map(H).join("; ")+";";function H(K){return K+": "+M.getPropertyValue(K)+(M.getPropertyPriority(K)?" !important":"")}}}}}function k(){p instanceof HTMLTextAreaElement&&(x.innerHTML=p.value),p instanceof HTMLInputElement&&x.setAttribute("value",p.value)}function _(){x instanceof SVGElement&&(x.setAttribute("xmlns","http://www.w3.org/2000/svg"),x instanceof SVGRectElement&&["width","height"].forEach(function(T){var I=x.getAttribute(T);I&&x.style.setProperty(T,I)}))}}}function J(u){return h.resolveAll().then(function(o){var d=document.createElement("style");return u.appendChild(d),d.appendChild(document.createTextNode(o)),u})}function Z(u){return w.inlineAll(u).then(function(){return u})}function Y(u,o,d){return Promise.resolve(u).then(function(v){return v.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(v)}).then(e.escapeXhtml).then(function(v){return'<foreignObject x="0" y="0" width="100%" height="100%">'+v+"</foreignObject>"}).then(function(v){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+o+'" height="'+d+'">'+v+"</svg>"}).then(function(v){return"data:image/svg+xml;charset=utf-8,"+v})}function W(){return{escape:_,parseExtension:o,mimeType:d,dataAsUrl:k,isDataUrl:v,canvasToBlob:b,resolveUrl:p,getAndEncode:D,uid:x(),delay:T,asArray:I,escapeXhtml:U,makeImage:L,width:N,height:F};function u(){var r="application/font-woff",y="image/jpeg";return{woff:r,woff2:r,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:y,jpeg:y,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function o(r){var y=/\.([^\.\/]*?)$/g.exec(r);return y?y[1]:""}function d(r){var y=o(r).toLowerCase();return u()[y]||""}function v(r){return r.search(/^(data:)/)!==-1}function S(r){return new Promise(function(y){for(var E=window.atob(r.toDataURL().split(",")[1]),j=E.length,A=new Uint8Array(j),O=0;O<j;O++)A[O]=E.charCodeAt(O);y(new Blob([A],{type:"image/png"}))})}function b(r){return r.toBlob?new Promise(function(y){r.toBlob(y)}):S(r)}function p(r,y){var E=document.implementation.createHTMLDocument(),j=E.createElement("base");E.head.appendChild(j);var A=E.createElement("a");return E.body.appendChild(A),j.href=y,A.href=r,A.href}function x(){var r=0;return function(){return"u"+y()+r++;function y(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function L(r){return new Promise(function(y,E){var j=new Image;j.onload=function(){y(j)},j.onerror=E,j.src=r})}function D(r){var y=3e4;return s.impl.options.cacheBust&&(r+=(/\?/.test(r)?"&":"?")+new Date().getTime()),new Promise(function(E){var j=new XMLHttpRequest;j.onreadystatechange=ee,j.ontimeout=te,j.responseType="blob",j.timeout=y,j.open("GET",r,!0),j.send();var A;if(s.impl.options.imagePlaceholder){var O=s.impl.options.imagePlaceholder.split(/,/);O&&O[1]&&(A=O[1])}function ee(){if(j.readyState===4){if(j.status!==200){A?E(A):M("cannot fetch resource: "+r+", status: "+j.status);return}var H=new FileReader;H.onloadend=function(){var K=H.result.split(/,/)[1];E(K)},H.readAsDataURL(j.response)}}function te(){A?E(A):M("timeout of "+y+"ms occured while fetching resource: "+r)}function M(H){console.error(H),E("")}})}function k(r,y){return"data:"+y+";base64,"+r}function _(r){return r.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function T(r){return function(y){return new Promise(function(E){setTimeout(function(){E(y)},r)})}}function I(r){for(var y=[],E=r.length,j=0;j<E;j++)y.push(r[j]);return y}function U(r){return r.replace(/#/g,"%23").replace(/\n/g,"%0A")}function N(r){var y=$(r,"border-left-width"),E=$(r,"border-right-width");return r.scrollWidth+y+E}function F(r){var y=$(r,"border-top-width"),E=$(r,"border-bottom-width");return r.scrollHeight+y+E}function $(r,y){var E=window.getComputedStyle(r).getPropertyValue(y);return parseFloat(E.replace("px",""))}}function ge(){var u=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:S,shouldProcess:o,impl:{readUrls:d,inline:v}};function o(b){return b.search(u)!==-1}function d(b){for(var p=[],x;(x=u.exec(b))!==null;)p.push(x[1]);return p.filter(function(L){return!e.isDataUrl(L)})}function v(b,p,x,L){return Promise.resolve(p).then(function(k){return x?e.resolveUrl(k,x):k}).then(L||e.getAndEncode).then(function(k){return e.dataAsUrl(k,e.mimeType(p))}).then(function(k){return b.replace(D(p),"$1"+k+"$3")});function D(k){return new RegExp(`(url\\(['"]?)(`+e.escape(k)+`)(['"]?\\))`,"g")}}function S(b,p,x){if(L())return Promise.resolve(b);return Promise.resolve(b).then(d).then(function(D){var k=Promise.resolve(b);return D.forEach(function(_){k=k.then(function(T){return v(T,_,p,x)})}),k});function L(){return!o(b)}}}function ve(){return{resolveAll:u,impl:{readAll:o}};function u(){return o().then(function(d){return Promise.all(d.map(function(v){return v.resolve()}))}).then(function(d){return d.join(`
`)})}function o(){return Promise.resolve(e.asArray(document.styleSheets)).then(v).then(d).then(function(b){return b.map(S)});function d(b){return b.filter(function(p){return p.type===CSSRule.FONT_FACE_RULE}).filter(function(p){return a.shouldProcess(p.style.getPropertyValue("src"))})}function v(b){var p=[];return b.forEach(function(x){try{e.asArray(x.cssRules||[]).forEach(p.push.bind(p))}catch(L){console.log("Error while reading CSS rules from "+x.href,L.toString())}}),p}function S(b){return{resolve:function(){var x=(b.parentStyleSheet||{}).href;return a.inlineAll(b.cssText,x)},src:function(){return b.style.getPropertyValue("src")}}}}}function we(){return{inlineAll:o,impl:{newImage:u}};function u(d){return{inline:v};function v(S){return e.isDataUrl(d.src)?Promise.resolve():Promise.resolve(d.src).then(S||e.getAndEncode).then(function(b){return e.dataAsUrl(b,e.mimeType(d.src))}).then(function(b){return new Promise(function(p,x){d.onload=p,d.onerror=x,d.src=b})})}}function o(d){if(!(d instanceof Element))return Promise.resolve(d);return v(d).then(function(){return d instanceof HTMLImageElement?u(d).inline():Promise.all(e.asArray(d.childNodes).map(function(S){return o(S)}))});function v(S){var b=S.style.getPropertyValue("background");return b?a.inlineAll(b).then(function(p){S.style.setProperty("background",p,S.style.getPropertyPriority("background"))}).then(function(){return S}):Promise.resolve(S)}}}})()})(me);var qe=me.exports;const Je=be(qe);var pe={exports:{}};(function(c,f){(function(e,a){a()})(Q,function(){function e(n,t){return typeof t>"u"?t={autoBom:!1}:typeof t!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob(["\uFEFF",n],{type:n.type}):n}function a(n,t,P){var g=new XMLHttpRequest;g.open("GET",n),g.responseType="blob",g.onload=function(){m(g.response,t,P)},g.onerror=function(){console.error("could not download file")},g.send()}function h(n){var t=new XMLHttpRequest;t.open("HEAD",n,!1);try{t.send()}catch{}return 200<=t.status&&299>=t.status}function w(n){try{n.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(t)}}var l=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Q=="object"&&Q.global===Q?Q:void 0,s=l.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),m=l.saveAs||(typeof window!="object"||window!==l?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(n,t,P){var g=l.URL||l.webkitURL,R=document.createElement("a");t=t||n.name||"download",R.download=t,R.rel="noopener",typeof n=="string"?(R.href=n,R.origin===location.origin?w(R):h(R.href)?a(n,t,P):w(R,R.target="_blank")):(R.href=g.createObjectURL(n),setTimeout(function(){g.revokeObjectURL(R.href)},4e4),setTimeout(function(){w(R)},0))}:"msSaveOrOpenBlob"in navigator?function(n,t,P){if(t=t||n.name||"download",typeof n!="string")navigator.msSaveOrOpenBlob(e(n,P),t);else if(h(n))a(n,t,P);else{var g=document.createElement("a");g.href=n,g.target="_blank",setTimeout(function(){w(g)})}}:function(n,t,P,g){if(g=g||open("","_blank"),g&&(g.document.title=g.document.body.innerText="downloading..."),typeof n=="string")return a(n,t,P);var R=n.type==="application/octet-stream",z=/constructor/i.test(l.HTMLElement)||l.safari,q=/CriOS\/[\d]+/.test(navigator.userAgent);if((q||R&&z||s)&&typeof FileReader<"u"){var J=new FileReader;J.onloadend=function(){var W=J.result;W=q?W:W.replace(/^data:[^;]*;/,"data:attachment/file;"),g?g.location.href=W:location=W,g=null},J.readAsDataURL(n)}else{var Z=l.URL||l.webkitURL,Y=Z.createObjectURL(n);g?g.location=Y:location.href=Y,g=null,setTimeout(function(){Z.revokeObjectURL(Y)},4e4)}});l.saveAs=m.saveAs=m,c.exports=m})})(pe);var Ye=pe.exports;const Ke="/desktop-tools/assets/resize-worker-OlxEQlEm.js";function Qe(c){const[f,e]=C.useState(),a=C.useRef(),h=C.useRef(G);return C.useEffect(()=>{if(!c)return;const w=(s=!1)=>{const m=c.getBoundingClientRect(),{saveSize:n,setSaveSize:t}=X();let P=n.width||m.width,g=n.height||m.height;if(s)P=m.width,g=m.height;else if(a.current){const{width:R,height:z}=a.current;R===P&&(P=m.width),z===g&&(g=m.height)}t({width:P,height:g,aspectRatio:P/g}),a.current=m,e(m)},l=new ResizeObserver(()=>w());return w(),h.current=()=>w(!0),l.observe(c),()=>l.disconnect()},[c]),[f,h.current]}function Ze(){const c=Le(Ke);return C.useCallback(async f=>{if(!f)return;const{saveSize:e}=X(),a=f.getBoundingClientRect();let{width:h,height:w}=e;h||(h=a.width),w||(w=a.height);const l=h!==a.width||w!==a.height;return Je.toBlob(f).then(s=>{const m=URL.createObjectURL(s);return l?(ue.appear("dyylpt.resize-download",{ow:a.width,oh:a.height,nw:h,nh:w}),c.action("resize",{url:m,width:h,height:w}).then(n=>(URL.revokeObjectURL(m),n))):m}).then(s=>{s&&(Ye.saveAs(s,`${new Date().toLocaleString()}.png`),URL.revokeObjectURL(s))})},[c])}function Ut(){const[c,f]=C.useState([]),e=C.useRef(null),[,a]=Qe(e.current),h=C.useCallback(w=>f(l=>{const s=w(l);return ue.event("dyylpt.updatePreviewList",{oldLength:l.length,newLength:s.length}),s}),[]);return i.jsxs(Be,{children:[i.jsx(Oe,{id:"preview-area",ref:e,list:c}),i.jsx(Xe,{list:c,applyDomSize:a,onChange:h})]})}function et(){const c=Ze();return i.jsx(fe,{buttons:[{text:"配置",onClick:()=>X().setShowForm(!0)},{text:"保存",onClick:()=>{c(document.getElementById("preview-area")).then(()=>{re().showMessage({type:"success",content:"保存成功"})})}}]})}const Ft={title:"电影语录拼图",needBackIcon:!0,rightArea:i.jsx(et,{})};export{Ut as Component,Ft as handle};
