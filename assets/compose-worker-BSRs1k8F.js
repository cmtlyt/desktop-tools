const s=function(t){const n=(t==null?void 0:t.clength)||(t==null?void 0:t.length)||0;if(!n)throw new TypeError("无法读取函数参数列表的长度，不能使用可选参数和剩余参数！！！");const a=(...e)=>{if(e.length>=n)return t(...e);{const r=(...c)=>a(...e.concat(c));return r.clength=n-e.length,r}};return a.clength=n,a};s((t,n)=>n.filter((a,e)=>t(a,e)));s((t,n)=>n.map((a,e)=>t(a,e)));s((t,n,a)=>a.reduce((e,r,c)=>t(e,r,c),n));s((t,n)=>n.every((a,e)=>t(a,e)));s((t,n)=>n.some((a,e)=>t(a,e)));s((t,n)=>n.find((a,e)=>t(a,e)));s((t,n)=>n.findIndex((a,e)=>t(a,e)));s((t,n)=>n.includes(t));s((t,n)=>n.join(t));s((t,n)=>(t(n),n));function D(t){let n=!1,a=null;return function(...e){return n?a:(n=!0,a=t(...e))}}s((t,n)=>{const a={};return d(t).forEach(e=>a[e]=n[e]),a});s((t,n)=>{const a={},e=d(t);return Object.keys(n).forEach(r=>{e.includes(r)||(a[r]=n[r])}),a});function y(t){return typeof t>"u"||typeof t=="object"&&t===null}function d(t){return y(t)?[]:Array.isArray(t)?t:[t]}const i={ctx:null,width:0,height:0,originImageData:new ImageData(1,1),imageData:new ImageData(1,1)};function b(t){var r;if(t.startsWith("#")){const[c,f,o]=((r=t.match(/\w{2}/g))==null?void 0:r.map(l=>parseInt(l,16)))??[0,0,0];return[c,f,o]}else t.startsWith("rgb")&&(t=t.replace(/^rgba?\((.*?)\)$/,"$1"));const[n=0,a=0,e=0]=t.split(",").map(c=>parseInt(c.trim(),10)).filter(c=>!isNaN(c));return[n,a,e]}function v(t,n){return a=>a.every((e,r)=>Math.abs(e-t[r])<n)}async function m(t){return fetch(t).then(n=>n.blob()).then(n=>createImageBitmap(n)).then(n=>{const{ctx:a}=i;if(!a)return new ImageData(1,1);const{width:e,height:r}=n;a.canvas.width=e,a.canvas.height=r,a.clearRect(0,0,e,r),a.drawImage(n,0,0);const c=a.getImageData(0,0,e,r);return a.clearRect(0,0,e,r),c})}async function x(t){const{imgs:n,options:a}=t,{jitterRange:e=30,replaceColor:r="#000000"}=a,c=b(r),f=v(c,e),o=await m(n[0]);i.width=o.width,i.height=o.height,i.originImageData=o;const l=o.data;for(const w of n.slice(1)){const{data:u}=await m(w);for(let g=0;g<u.length;g+=4){const h=[u[g],u[g+1],u[g+2],u[g+3]];f(h.slice(0,3))||h.forEach((p,I)=>l[g+I]=p)}}i.imageData=o}function C(t){const{ctx:n}=i;if(!n)return;const{width:a,height:e}=i;n.canvas.width=a,n.canvas.height=e,n.clearRect(0,0,a,e),n.putImageData(i.imageData,0,0)}const E=D(async()=>import("./index-DMFccjB8.js").then(function(t){return t.i}));async function k(t,n){const a=await E();return n.reduce((e,r)=>{var c;return((c=a[r])==null?void 0:c.call(a,e))||e},t)}async function j(t){if(i.imageData=i.originImageData,!t.filterList.length)return;const n=structuredClone(i.imageData);i.imageData=await k(n,t.filterList)}function H(t){const{offscreen:n}=t,e=n.getContext("2d");e&&(i.ctx=e)}self.addEventListener("message",async({data:t})=>{const{action:n,option:a}=t;switch(console.debug(t),n){case"init":{H(a);break}case"compose":{await x(a);break}case"filter":{await j(a);break}case"drawImage":{C();break}}self.postMessage({action:n})});
