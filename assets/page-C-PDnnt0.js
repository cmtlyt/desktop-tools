import{x as s,r as l}from"./index-CELkqAxd.js";import{B as S}from"./index-B2BLWxaP.js";import{h as b,l as g,R as v,g as m,U as w,V as x,d as R,B as p,b as y,w as E,C as j,P as A}from"./index-B6lmPcvh.js";import{S as C,c as D}from"./Subject-D1hfkXK8.js";import"./iconBase-BB3BNxHj.js";import"./index-ChGhJv57.js";import"./index-8ADkaGsT.js";import"./asyncToGenerator-Reog87Ni.js";const{useStore:Z,useStoreSlice:d,getStore:i}=b(e=>({name:null,stream:null,recorder:null,result:null,setName:t=>e({name:t}),setStream:t=>e({stream:t}),setRecorder:t=>e({recorder:t}),setResult:t=>e({result:t}),clear:()=>e({name:null,stream:null,recorder:null,result:null})}));var u=(e=>(e.RECORD_END="RECORD_END",e))(u||{});const f=new C;function T(e){f.next(e),g.event("recording-action",e)}const k=D(f);async function B(){try{const e=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:{channelCount:2}}),t=new MediaStream;return e.getTracks().forEach(n=>t.addTrack(n)),t}catch(e){g.error("get-screen-and-audio-stream",e.message)}}const h=x(()=>["video/webm;codecs=daala,opus","video/webm;codecs=vp9,opus","video/webm;codecs=vp8,opus","video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm;codecs=h264","video/webm","video/mp4","video/mpeg"].find(e=>MediaRecorder.isTypeSupported(e))||"");function M(e){const t=h();if(!t)throw new Error("No supported mime type found");return new MediaRecorder(e,{mimeType:t,videoBitsPerSecond:25e5,bitsPerSecond:25e5})}const{startRecording:N,stopRecording:I,listener:O}=(()=>{let e=[];return{startRecording:r=>{const o=M(r);return o.start(100),o},stopRecording:r=>{r.stop()},listener:(r,o)=>{r.ondataavailable=a=>{e.push(a.data)},r.onstop=()=>{r.stop();const a=new Blob(e,{type:h()});e=[],o(a)},console.debug(r)}}})();async function P(){const e=await B(),{recorder:t,setStream:n,setRecorder:c}=i();if(t)return;n(e);for(let o=5;o>0;o--)m().showMessage({content:`${o}秒后开始录制`}),await w(1e3);m().showMessage({content:"开始录制"});const r=N(e);O(r,o=>{i().setResult(o),T({id:"recording-end",type:u.RECORD_END})}),c(r)}async function H(){const{recorder:e}=i();I(e)}async function _(){const{result:e}=i();return e?v(e):""}const $=R.span``;function L(){const{name:e,recorder:t}=d(["name","recorder"]);return e?s.jsx(S,{buttons:[{text:"停止录制",$presetTheme:p.DANGER,hidden:!t,onClick:()=>H()},{text:"开始录制",$presetTheme:p.PRIMARY,hidden:!!t,onClick:()=>P()}]}):s.jsx($,{children:"请先输入视频名称"})}const V=R.input`
  all: inherit;
  border: none;
  outline: none;
`,q=e=>{i().setName(e.target.value)},F=j(q,300);function G(e){const{readOnly:t}=e,{name:n,recorder:c}=d(["name","recorder"]);return s.jsx(y,{children:s.jsx(E,{if:!t||!!c,fullback:s.jsx("span",{children:n}),children:()=>s.jsx(V,{defaultValue:n||"",placeholder:"请输入笔记标题",onChange:F})})})}function ee(){const e=l.useRef(null),{stream:t}=d("stream");return k(()=>{const{addRecord:n}=A(),{name:c,clear:r}=i();c&&_().then(o=>{r(),n({name:c,content:o})})},u.RECORD_END),l.useEffect(()=>{e.current&&t&&(e.current.srcObject=t)},[t]),s.jsx("video",{ref:e,muted:!0,autoPlay:!0})}const te={title:"录制器",needBackIcon:!0,rightArea:s.jsx(L,{}),titleArea:s.jsx(G,{})};export{ee as Component,te as handle};
