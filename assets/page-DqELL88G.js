import{x as s}from"./index-0LAKHuTr.js";import{B as S}from"./index-4p12tTF1.js";import{h,l,R as f,g as b,U as v,d as m,B as u,b as w,w as x,C as y,P as T}from"./index-Dnz2Iu2C.js";import{S as D,c as E}from"./Subject-Dy5BDqAo.js";import"./iconBase-sKEVBBKf.js";import"./index-CLFsw9Wl.js";import"./index-Cc3XqGQH.js";import"./asyncToGenerator-CJUAp7vk.js";const{useStore:W,useStoreSlice:p,getStore:i}=h(e=>({name:null,stream:null,recorder:null,result:null,setName:t=>e({name:t}),setStream:t=>e({stream:t}),setRecorder:t=>e({recorder:t}),setResult:t=>e({result:t}),clear:()=>e({name:null,stream:null,recorder:null,result:null})}));var d=(e=>(e.RECORD_END="RECORD_END",e))(d||{});const g=new D;function j(e){g.next(e),l.event("recording-action",e)}const A=E(g);async function C(){try{const e=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}),t=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new MediaStream;return e.getTracks().forEach(n=>r.addTrack(n)),t.getTracks().forEach(n=>r.addTrack(n)),r}catch(e){l.error("get-screen-and-audio-stream",e.message)}}const R=v(()=>["video/webm;codecs=daala,opus","video/webm;codecs=vp9,opus","video/webm;codecs=vp8,opus","video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm;codecs=h264","video/webm","video/mp4","video/mpeg"].find(e=>MediaRecorder.isTypeSupported(e))||"");function k(e){const t=R();if(!t)throw new Error("No supported mime type found");return new MediaRecorder(e,{mimeType:t,videoBitsPerSecond:25e5,bitsPerSecond:25e5})}const{startRecording:B,stopRecording:M,listener:N}=(()=>{let e=[];return{startRecording:o=>{const c=k(o);return c.start(100),c},stopRecording:o=>{o.stop()},listener:(o,c)=>{o.ondataavailable=a=>{e.push(a.data)},o.onstop=()=>{o.stop();const a=new Blob(e,{type:R()});e=[],c(a)},console.debug(o)}}})();async function I(){const e=await C(),{recorder:t,setStream:r,setRecorder:n}=i();if(t)return;r(e),b().showMessage({content:"开始录制"});const o=B(e);N(o,c=>{i().setResult(c),j({id:"recording-end",type:d.RECORD_END})}),n(o)}async function O(){const{recorder:e}=i();M(e)}async function H(){const{result:e}=i();return e?f(e):""}const P=m.span``;function _(){const{name:e,recorder:t}=p(["name","recorder"]);return e?s.jsx(S,{buttons:[{text:"停止录制",$presetTheme:u.DANGER,hidden:!t,onClick:()=>O()},{text:"开始录制",$presetTheme:u.PRIMARY,hidden:!!t,onClick:()=>I()}]}):s.jsx(P,{children:"请先输入视频名称"})}const L=m.input`
  all: inherit;
  border: none;
  outline: none;
`,U=e=>{i().setName(e.target.value)},$=y(U,300);function q(e){const{readOnly:t}=e,{name:r,recorder:n}=p(["name","recorder"]);return s.jsx(w,{children:s.jsx(x,{if:!t||!!n,fullback:s.jsx("span",{children:r}),children:()=>s.jsx(L,{defaultValue:r||"",placeholder:"请输入笔记标题",onChange:$})})})}function X(){return A(()=>{const{addRecord:e}=T(),{name:t,clear:r}=i();t&&H().then(n=>{r(),e({name:t,content:n})})},d.RECORD_END),s.jsx("div",{children:"录制中"})}const Z={title:"录制器",needBackIcon:!0,rightArea:s.jsx(_,{}),titleArea:s.jsx(q,{})};export{X as Component,Z as handle};
