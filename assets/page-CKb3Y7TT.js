import{m as z,B as w,r as s,j as e,l as f,k as F,C as K,D as P,E as V,G as q}from"./index-OukonhEp.js";import{A as W}from"./index-Csuulvot.js";import{b as l,c as S,a as L,F as D,e as J,B as Q,d as j}from"./button-DhFOA2LO.js";import{H as X,S as G,a as Z,b as ee,e as te,c as re}from"./index-Bfveh_q5.js";import{B as se}from"./index-C1xOYhvI.js";import{D as oe}from"./index-B37Z9A2N.js";import{M as ne}from"./index-Gdk0n4tk.js";import{S as ie}from"./icon-CxX3g0b6.js";import"./index-B4g9YTQJ.js";import"./index-Bx8MXlke.js";import"./index-Cvmrj1y4.js";import"./useLocale-B6ZB37ez.js";import"./asyncToGenerator-BAPzNxcx.js";import"./Subject-_y9GPRvX.js";import"./index-BuKfolBc.js";import"./index-CRjhIEA9.js";import"./reactNode-bi3AtoeM.js";import"./KeyCode-DNlgD2sM.js";import"./pickAttrs-40C-709n.js";import"./context-DSP-ehed.js";import"./Skeleton-DzVsumwS.js";import"./iconBase-biJJpZn2.js";import"./index-Bu99oLra.js";import"./is-phone-DrVOg5Cg.js";import"./index-BBkoJEH7.js";import"./UnstableContext-XsxeSzfD.js";import"./LoadingOutlined-BFgNkmaE.js";import"./useCSSVarCls-CAV_fRUy.js";import"./InfoCircleFilled-3LzT8n0V.js";import"./ActionButton-DNnhcShZ.js";import"./button-Br7OVFLJ.js";import"./compact-item-bfbNYmkQ.js";import"./fade-pXj69hT6.js";import"./PurePanel-CkONOp0R.js";const{useStore:Ve,useStoreSlice:ae,getStore:A}=z(t=>({speed:500,currentGameId:w(),replayStep:null,setSpeed:r=>t({speed:r}),reset:()=>t({currentGameId:w()}),replay:r=>t({replayStep:r})}));function pe(){const[t,r]=s.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(se,{buttons:[{text:"游戏规则",onClick(){ne.info({title:"游戏规则",okText:"知道了",centered:!0,content:e.jsx(W,{onFirstAppear:()=>f.appear("game-sbwd-rule"),children:e.jsxs(l,{$gap:"0.3",$direction:S.COLUMN,children:[e.jsx("span",{children:"1. 点击指针, 其指针顺时针旋转 90 度后指向的圆圈指针依次旋转"}),e.jsx("span",{children:"2. 剩余步数用完, 游戏结束"})]})})})}},{text:"游戏记录",onClick:()=>r(!0)},{text:"重置",onClick:()=>A().reset()}]}),e.jsx(X,{open:t,storeKey:G,onClose:()=>r(!1),children:n=>e.jsxs(Z,{$direction:S.COLUMN,$gap:"0.5",children:[e.jsxs(ee,{$alignItems:L.CENTER,$justifyContent:D.BETWEEN,children:[e.jsxs("span",{children:["分数: ",n.totalRotate]}),e.jsx(oe,{format:"yyyy-MM-DD hh:mm:ss",children:n.time})]}),e.jsx(l,{$justifyContent:D.END,children:e.jsx(J,{$presetTheme:Q.PRIMARY,onClick:()=>{const c=n.stepHistory;r(!1),A().replay(c),f.click("game-sbwd-history-replay",{stepHistory:c})},children:"重放"})})]},n.gameId)})]})}const ce=j(l)`
  padding: var(--page-padding);
`,le=j(l)`
  width: 60vmin;
  height: 60vmin;
`,me=s.memo(j(ie)`
  width: 100%;
  height: 100%;
  transform: rotate(${({$rotate:t})=>t}deg);
  transition: transform ${({$speed:t})=>t}ms;
`),O=j.span`
  font-size: 3rem;
`;function ue(t){return t%360===0?"top":t%360===90?"right":t%360===180?"bottom":"left"}function fe(t,r,n){return n==="top"?[t-1,r]:n==="right"?[t,r+1]:n==="bottom"?[t+1,r]:[t,r-1]}function qe(){const t=[5,5],[r,n]=t,{speed:c,currentGameId:d,replayStep:h}=ae(["speed","currentGameId","replayStep"]),[U,T]=s.useState(Array.from({length:r},()=>new Array(n).fill(0))),[x,b]=s.useState(0),[R,B]=s.useState(10),[m,H]=s.useState(!1),$=s.useRef([]),C=s.useRef(d),g=s.useRef(h),I=s.useRef(!1),k=s.useMemo(()=>{const o=V((i,p)=>{b(a=>a+90),T(q(a=>{var N;const y=a[i][p]=a[i][p]+90,Y=ue(y),[M,v]=fe(i,p,Y),_=(N=a[M])==null?void 0:N[v];setTimeout(()=>{if(_===void 0)return H(!1);o(M,v)},c)}))},10,!0);return o},[c]),E=s.useCallback((o,i)=>{m||($.current.push(`${o},${i}`),H(!0),k(o,i),B(p=>p-1))},[m,k]),u=s.useCallback(()=>{$.current=[],T(Array.from({length:r},()=>new Array(n).fill(0))),B(10),b(0),I.current=!1},[r,n]);return s.useEffect(()=>{if(!m&&R<=0){if(I.current)return F().showMessage({content:"回放结束"});const o={gameId:C.current,totalRotate:x,stepHistory:$.current};K(G,{...o,time:Date.now()}),P(),f.event("game-sbwd-over",o),f.expose("game-sbwd-over"),te({id:"reload-history",type:re.RELOAD_HISTORY}),F().showMessage({content:`游戏结束, 当前分数 ${x}!`,onClose:u})}},[m,u,x,R]),s.useEffect(()=>{C.current!==d&&(C.current=d,u())},[d,u]),s.useEffect(()=>{var i;if(!h)return;(i=g.current)!=null&&i.length||(u(),I.current=!0,g.current=h.slice());const o=setInterval(()=>{var y;if(m)return;const[p,a]=((y=g.current.shift())==null?void 0:y.split(",").map(Number))||[];if(E(p,a),!g.current.length){clearInterval(o),A().replay(null);return}},c);return()=>clearInterval(o)},[h,c,m,E,u]),e.jsx(W,{onFirstAppear:()=>f.appear("game-sbwd"),children:e.jsxs(ce,{$flex:"1",$gap:"5",$direction:S.COLUMN,$alignItems:L.CENTER,$justifyContent:D.CENTER,children:[e.jsxs(l,{$gap:"1",children:[e.jsxs(O,{children:["剩余步数: ",R]}),e.jsxs(O,{children:["当前度数: ",x]})]}),e.jsx(le,{$direction:S.COLUMN,$gap:"1",children:U.map((o,i)=>e.jsx(l,{$gap:"1",children:o.map((p,a)=>e.jsx(l,{$flex:"1",onClick:()=>E(i,a),children:e.jsx(me,{$rotate:p,$speed:c})},a))},i))})]})})}const Je={title:"十步万度",needBackIcon:!0,rightArea:e.jsx(pe,{})};export{qe as Component,Je as handle};
