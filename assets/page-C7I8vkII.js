import{n as z,C as w,r as s,j as e,l as f,G as K,m as F,D as P,E as V,H as q}from"./index-Ch4bek_b.js";import{A as L}from"./index-D0Yvu1ca.js";import{b as l,c as S,F as A,a as W,e as J,B as Q,d as j}from"./button-ChdjSb5e.js";import{H as X,S as G,a as Z,b as ee,e as te,c as re}from"./index-DhIaIRmc.js";import{B as se}from"./index-CiOg3lfn.js";import{D as ne}from"./index-BpUMhzI1.js";import{M as oe}from"./index-iDj8thIR.js";import{S as ae}from"./icon-B-BVlENi.js";import"./index-B4g9YTQJ.js";import"./index-DUNRm7oh.js";import"./index-BkUqqAG2.js";import"./useLocale-CkrnKRaz.js";import"./asyncToGenerator-CdfDXCsZ.js";import"./Subject-CC7OZsq2.js";import"./index-B7KP0Gm3.js";import"./index-D6D3cjcs.js";import"./reactNode-xDrto8Ml.js";import"./pickAttrs-CGR3EVLK.js";import"./context-D9gjIaun.js";import"./Skeleton-DYPGJwkD.js";import"./iconBase-DzU9LrI2.js";import"./index-D88M7-Vq.js";import"./is-phone-DqVyIJsf.js";import"./UnstableContext-u56mSdlo.js";import"./LoadingOutlined-Bls90OqU.js";import"./ExclamationCircleFilled-D-roEu99.js";import"./InfoCircleFilled-BW2pLvUB.js";import"./ActionButton-DPwPH2zi.js";import"./PurePanel-CD-7UOLN.js";import"./compact-item-DXyW-YUr.js";import"./index-C7JRvgDk.js";import"./fade-CP-LmfEu.js";const{useStoreSlice:ie,getStore:D}=z(t=>({speed:500,currentGameId:w(),replayStep:null,setSpeed:r=>t({speed:r}),reset:()=>t({currentGameId:w()}),replay:r=>t({replayStep:r})}));function ce(){const[t,r]=s.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(se,{buttons:[{text:"游戏规则",onClick(){oe.info({title:"游戏规则",okText:"知道了",centered:!0,content:e.jsx(L,{onFirstAppear:()=>f.appear("game-sbwd-rule"),children:e.jsxs(l,{$gap:"0.3",$direction:S.COLUMN,children:[e.jsx("span",{children:"1. 点击指针, 其指针顺时针旋转 90 度后指向的圆圈指针依次旋转"}),e.jsx("span",{children:"2. 剩余步数用完, 游戏结束"})]})})})}},{text:"游戏记录",onClick:()=>r(!0)},{text:"重置",onClick:()=>D().reset()}]}),e.jsx(X,{open:t,storeKey:G,onClose:()=>r(!1),children:o=>e.jsxs(Z,{$direction:S.COLUMN,$gap:"0.5",children:[e.jsxs(ee,{$alignItems:W.CENTER,$justifyContent:A.BETWEEN,children:[e.jsxs("span",{children:["分数: ",o.totalRotate]}),e.jsx(ne,{format:"yyyy-MM-DD hh:mm:ss",children:o.time})]}),e.jsx(l,{$justifyContent:A.END,children:e.jsx(J,{$presetTheme:Q.PRIMARY,onClick:()=>{const p=o.stepHistory;r(!1),D().replay(p),f.click("game-sbwd-history-replay",{stepHistory:p})},children:"重放"})})]},o.gameId)})]})}const pe=j(l)`
  padding: var(--page-padding);
`,le=j(l)`
  width: 60vmin;
  height: 60vmin;
`,me=s.memo(j(ae)`
  width: 100%;
  height: 100%;
  transform: rotate(${({$rotate:t})=>t}deg);
  transition: transform ${({$speed:t})=>t}ms;
`),O=j.span`
  font-size: 3rem;
`;function ue(t){return t%360===0?"top":t%360===90?"right":t%360===180?"bottom":"left"}function fe(t,r,o){return o==="top"?[t-1,r]:o==="right"?[t,r+1]:o==="bottom"?[t+1,r]:[t,r-1]}function Ke(){const t=[5,5],[r,o]=t,{speed:p,currentGameId:d,replayStep:h}=ie(["speed","currentGameId","replayStep"]),[U,H]=s.useState(Array.from({length:r},()=>new Array(o).fill(0))),[x,T]=s.useState(0),[R,b]=s.useState(10),[m,B]=s.useState(!1),$=s.useRef([]),C=s.useRef(d),g=s.useRef(h),I=s.useRef(!1),M=s.useMemo(()=>{const n=K((a,c)=>{T(i=>i+90),H(q(i=>{var N;const y=i[a][c]=i[a][c]+90,Y=ue(y),[k,v]=fe(a,c,Y),_=(N=i[k])==null?void 0:N[v];setTimeout(()=>{if(_===void 0)return B(!1);n(k,v)},p)}))},10,!0);return n},[p]),E=s.useCallback((n,a)=>{m||($.current.push(`${n},${a}`),B(!0),M(n,a),b(c=>c-1))},[m,M]),u=s.useCallback(()=>{$.current=[],H(Array.from({length:r},()=>new Array(o).fill(0))),b(10),T(0),I.current=!1},[r,o]);return s.useEffect(()=>{if(!m&&R<=0){if(I.current)return F().showMessage({content:"回放结束"});const n={gameId:C.current,totalRotate:x,stepHistory:$.current};P(G,{...n,time:Date.now()}),V(),f.event("game-sbwd-over",n),f.expose("game-sbwd-over"),te({id:"reload-history",type:re.RELOAD_HISTORY}),F().showMessage({content:`游戏结束, 当前分数 ${x}!`,onClose:u})}},[m,u,x,R]),s.useEffect(()=>{C.current!==d&&(C.current=d,u())},[d,u]),s.useEffect(()=>{var a;if(!h)return;(a=g.current)!=null&&a.length||(u(),I.current=!0,g.current=h.slice());const n=setInterval(()=>{var y;if(m)return;const[c,i]=((y=g.current.shift())==null?void 0:y.split(",").map(Number))||[];if(E(c,i),!g.current.length){clearInterval(n),D().replay(null);return}},p);return()=>clearInterval(n)},[h,p,m,E,u]),e.jsx(L,{onFirstAppear:()=>f.appear("game-sbwd"),children:e.jsxs(pe,{$flex:"1",$gap:"5",$direction:S.COLUMN,$alignItems:W.CENTER,$justifyContent:A.CENTER,children:[e.jsxs(l,{$gap:"1",children:[e.jsxs(O,{children:["剩余步数: ",R]}),e.jsxs(O,{children:["当前度数: ",x]})]}),e.jsx(le,{$direction:S.COLUMN,$gap:"1",children:U.map((n,a)=>e.jsx(l,{$gap:"1",children:n.map((c,i)=>e.jsx(l,{$flex:"1",onClick:()=>E(a,i),children:e.jsx(me,{$rotate:c,$speed:p})},i))},a))})]})})}const Pe={title:"十步万度",needBackIcon:!0,rightArea:e.jsx(ce,{})};export{Ke as Component,Pe as handle};
